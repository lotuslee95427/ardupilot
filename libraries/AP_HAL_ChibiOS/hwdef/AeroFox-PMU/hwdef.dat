# 包含AeroFox-PMU的通用硬件配置文件
include ../AeroFox-PMU/hwdef.inc

# 配置串口顺序:USART1用于调试,USART3用于电调通信
SERIAL_ORDER USART1 EMPTY USART3

# 配置电调串口(USART3)引脚
PB10  USART3_TX USART3 SPEED_HIGH  # 电调串口发送引脚
PB11  USART3_RX USART3 SPEED_HIGH  # 电调串口接收引脚

# 预留的USART2接口(已注释)
#PA2 USART2_TX USART2 SPEED_HIGH
#PA3 USART2_RX USART2 SPEED_HIGH

# 调试串口(USART1)引脚配置
PB6  USART1_TX USART1 SPEED_HIGH   # 调试串口发送引脚
PB7  USART1_RX USART1 SPEED_HIGH   # 调试串口接收引脚

# 启用电池监测功能
define HAL_PERIPH_ENABLE_BATTERY

# 配置ADC相关参数
define HAL_USE_ADC TRUE             # 启用ADC功能
define STM32_ADC_USE_ADC1 TRUE      # 使用ADC1

# 配置电池电压和电流检测引脚
PB0 BATT_VOLTAGE_SENS  ADC1 SCALE(1)  # 电池电压检测引脚
PB1 BATT_CURRENT_SENS  ADC1 SCALE(1)  # 电池电流检测引脚

# 电池监测相关参数配置
define HAL_BATT_MONITOR_DEFAULT  0     # 默认电池监测类型
define HAL_BATT_VOLT_PIN 5            # 电压检测引脚编号
define HAL_BATT_VOLT_SCALE 21.0       # 电压转换比例
define HAL_BATT_CURR_PIN 6            # 电流检测引脚编号
define HAL_BATT_CURR_SCALE 40.0       # 电流转换比例

# PWM输出通道配置
PA8   TIM1_CH1  TIM1 PWM(1) GPIO(50)   # PWM通道1
PA9   TIM1_CH2  TIM1 PWM(2) GPIO(51)   # PWM通道2
PA10  TIM1_CH3  TIM1 PWM(3) GPIO(52)   # PWM通道3
PA11  TIM1_CH4  TIM1 PWM(4) GPIO(53)   # PWM通道4
PA15  TIM2_CH1  TIM2 PWM(5) GPIO(54)   # PWM通道5
PA2   TIM2_CH3  TIM2 PWM(6) GPIO(55)   # PWM通道6
PA3   TIM2_CH4  TIM2 PWM(7) GPIO(56)   # PWM通道7
PA1   TIM2_CH2  TIM2 PWM(8) GPIO(57)   # PWM通道8
PA6   TIM16_CH1 TIM16  PWM(9)  GPIO(58) NODMA  # PWM通道9

# 启用PWM输出和通知功能
define HAL_PERIPH_ENABLE_RC_OUT
define HAL_PERIPH_ENABLE_NOTIFY

# 启用电调控制功能
define HAL_SUPPORT_RCOUT_SERIAL 1    # 支持串行电调输出
define HAL_WITH_ESC_TELEM 1          # 支持电调遥测

# RGB LED配置
define AP_NOTIFY_GPIO_LED_RGB_ENABLED 1   # 启用RGB LED
PB2 LED_RED OUTPUT OPENDRAIN HIGH GPIO(0)    # 红色LED引脚
PB4 LED_GREEN OUTPUT OPENDRAIN LOW GPIO(1)   # 绿色LED引脚
PB5 LED_BLUE OUTPUT OPENDRAIN LOW GPIO(2)    # 蓝色LED引脚
define AP_NOTIFY_GPIO_LED_RGB_RED_PIN 0      # 红色LED引脚编号
define AP_NOTIFY_GPIO_LED_RGB_GREEN_PIN 1    # 绿色LED引脚编号
define AP_NOTIFY_GPIO_LED_RGB_BLUE_PIN 2     # 蓝色LED引脚编号

# 启用电调串口通信和接收机输入线程
define HAL_SERIAL_ESC_COMM_ENABLED 1     # 启用电调串口通信
define HAL_RCIN_THREAD_ENABLED 1         # 启用接收机输入线程
